CREATE OR REPLACE TABLE {{ params.stage_db }}.{{ params.stage_schema }}.{{ params.stage_table_exploded }}
(
clientId VARCHAR,
fullVisitorId VARCHAR NOT NULL,
visitorId VARCHAR,
userId VARCHAR,
visitNumber INT,
visitId INT NOT NULL,
visitStartTime INT,
date DATE,
totals VARIANT,
totals_bounces INT,
totals_hits INT,
totals_newVisits INT,
totals_pageviews INT,
totals_screenviews INT,
totals_sessionQualityDim INT,
totals_timeOnScreen INT,
totals_timeOnSite INT,
totals_totalTransactionRevenue INT,
totals_transactionRevenue INT,
totals_transactions INT,
totals_UniqueScreenViews INT,
totals_visits INT,
trafficSource VARIANT,
trafficSource_adContent VARCHAR,
trafficSource_adwordsClickInfo VARIANT,
trafficSource_adwordsClickInfo_adGroupId INT,
trafficSource_adwordsClickInfo_adNetworkType VARCHAR,
trafficSource_adwordsClickInfo_campaignId INT,
trafficSource_adwordsClickInfo_creativeId INT,
trafficSource_adwordsClickInfo_criteriaId INT,
trafficSource_adwordsClickInfo_criteriaParameters VARCHAR,
trafficSource_adwordsClickInfo_customerId INT,
trafficSource_adwordsClickInfo_gclId VARCHAR,
trafficSource_adwordsClickInfo_isVideoAd BOOLEAN,
trafficSource_adwordsClickInfo_page INT,
trafficSource_adwordsClickInfo_slot VARCHAR,
trafficSource_adwordsClickInfo_targetingCriteria VARIANT,
trafficSource_adwordsClickInfo_targetingCriteria_boomUserlistId INT,
trafficSource_campaign VARCHAR,
trafficSource_campaignCode VARCHAR,
trafficSource_isTrueDirect BOOLEAN,
trafficSource_keyword VARCHAR,
trafficSource_medium VARCHAR,
trafficSource_referralPath VARCHAR,
trafficSource_source VARCHAR,
socialEngagementType VARCHAR,
channelGrouping VARCHAR,
device VARIANT,
device_browser VARCHAR,
device_browserSize VARCHAR,
device_browserVersion VARCHAR,
device_deviceCategory VARCHAR,
device_mobileDeviceInfo VARCHAR,
device_mobileDeviceMarketingName VARCHAR,
device_mobileDeviceModel VARCHAR,
device_mobileInputSelector VARCHAR,
device_operatingSystem VARCHAR,
device_operatingSystemVersion VARCHAR,
device_isMobile BOOLEAN,
device_mobileDeviceBranding VARCHAR,
device_flashVersion VARCHAR,
device_javaEnabled BOOLEAN,
device_language VARCHAR,
device_screenColors VARCHAR,
device_screenResolution VARCHAR,
customDimensions VARIANT,
customDimensions_index INT,
customDimensions_value VARCHAR,
geoNetwork VARIANT,
geoNetwork_continent VARCHAR,
geoNetwork_subContinent VARCHAR,
geoNetwork_country VARCHAR,
geoNetwork_region VARCHAR,
geoNetwork_metro VARCHAR,
geoNetwork_city VARCHAR,
geoNetwork_cityId VARCHAR,
geoNetwork_latitude VARCHAR,
geoNetwork_longitude VARCHAR,
geoNetwork_networkDomain VARCHAR,
geoNetwork_networkLocation VARCHAR,
privacy_info VARIANT,
privacy_info_ads_storage VARCHAR,
privacy_info_analytics_storage VARCHAR,
privacy_info_uses_transient_token VARCHAR,
hits VARIANT,
hits_time INT,
hits_dataSource VARCHAR,
hits_referrer VARCHAR,
hits_type VARCHAR,
hits_sourcePropertyInfo VARIANT,
hits_sourcePropertyInfo_sourcePropertyDisplayName VARCHAR,
hits_sourcePropertyInfo_sourcePropertyTrackingId VARCHAR,
hits_eCommerceAction VARIANT,
hits_eCommerceAction_action_type VARCHAR,
hits_eCommerceAction_option VARCHAR,
hits_eCommerceAction_step INT,
hits_exceptionInfo VARIANT,
hits_exceptionInfo_description VARCHAR,
hits_exceptionInfo_isFatal BOOLEAN,
hits_exceptionInfo_exceptions INT,
hits_exceptionInfo_fatalExceptions INT,
hits_hitNumber INT,
hits_hour INT,
hits_isSecure BOOLEAN,
hits_isEntrance BOOLEAN,
hits_isExit BOOLEAN,
hits_isInteraction BOOLEAN,
hits_latencyTracking VARIANT,
hits_latencyTracking_domainLookupTime INT,
hits_latencyTracking_domContentLoadedTime INT,
hits_latencyTracking_domInteractiveTime INT,
hits_latencyTracking_domLatencyMetricsSample INT,
hits_latencyTracking_pageDownloadTime INT,
hits_latencyTracking_pageLoadSample INT,
hits_latencyTracking_pageLoadTime INT,
hits_latencyTracking_redirectionTime INT,
hits_latencyTracking_serverConnectionTime INT,
hits_latencyTracking_serverResponseTime INT,
hits_latencyTracking_speedMetricsSample INT,
hits_latencyTracking_userTimingCategory VARCHAR,
hits_latencyTracking_userTimingLabel VARCHAR,
hits_latencyTracking_userTimingSample INT,
hits_latencyTracking_userTimingValue INT,
hits_latencyTracking_userTimingVariable VARCHAR,
hits_minute INT,
hits_page VARIANT,
hits_page_pagePath VARCHAR,
hits_page_pagePathLevel1 VARCHAR,
hits_page_pagePathLevel2 VARCHAR,
hits_page_pagePathLevel3 VARCHAR,
hits_page_pagePathLevel4 VARCHAR,
hits_page_hostname VARCHAR,
hits_page_pageTitle VARCHAR,
hits_page_searchKeyword VARCHAR,
hits_page_searchCategory VARCHAR,
hits_transaction VARIANT,
hits_transaction_transactionId VARCHAR,
hits_transaction_transactionRevenue INT,
hits_transaction_transactionTax INT,
hits_transaction_transactionShipping INT,
hits_transaction_affiliation VARCHAR,
hits_transaction_currencyCode VARCHAR,
hits_transaction_localTransactionRevenue INT,
hits_transaction_localTransactionTax INT,
hits_transaction_localTransactionShipping INT,
hits_transaction_transactionCoupon VARCHAR,
hits_item VARIANT,
hits_item_transactionId VARCHAR,
hits_item_productName VARCHAR,
hits_item_productCategory VARCHAR,
hits_item_productSku VARCHAR,
hits_item_itemQuantity INT,
hits_item_itemRevenue INT,
hits_item_currencyCode VARCHAR,
hits_item_localItemRevenue INT,
hits_contentInfo VARIANT,
hits_contentInfo_contentDescription VARCHAR,
hits_appInfo VARIANT,
hits_appInfo_appInstallerId VARCHAR,
hits_appInfo_appName VARCHAR,
hits_appInfo_appVersion VARCHAR,
hits_appInfo_appId VARCHAR,
hits_appInfo_screenName VARCHAR,
hits_appInfo_landingScreenName VARCHAR,
hits_appInfo_exitScreenName VARCHAR,
hits_appInfo_screenDepth VARCHAR,
hits_eventInfo VARIANT,
hits_eventInfo_eventCategory VARCHAR,
hits_eventInfo_eventAction VARCHAR,
hits_eventInfo_eventLabel VARCHAR,
hits_eventInfo_eventValue INT,
hits_promotion VARIANT,
hits_promotion_promoCreative VARCHAR,
hits_promotion_promoId VARCHAR,
hits_promotion_promoName VARCHAR,
hits_promotion_promoPosition VARCHAR,
hits_promotionActionInfo VARIANT,
hits_promotionActionInfo_promoIsView BOOLEAN,
hits_promotionActionInfo_promoIsClick BOOLEAN,
hits_refund VARIANT,
hits_refund_localRefundAmount INT,
hits_refund_refundAmount INT,
hits_experiment VARIANT,
hits_experiment_experimentId VARCHAR,
hits_experiment_experimentVariant VARCHAR,
hits_publisher VARIANT,
hits_publisher_adsenseBackfillDfpClicks INT,
hits_publisher_adsenseBackfillDfpImpressions INT,
hits_publisher_adsenseBackfillDfpMatchedQueries INT,
hits_publisher_adsenseBackfillDfpMeasurableImpressions INT,
hits_publisher_adsenseBackfillDfpPagesViewed INT,
hits_publisher_adsenseBackfillDfpQueries INT,
hits_publisher_adsenseBackfillDfpRevenueCpc INT,
hits_publisher_adsenseBackfillDfpRevenueCpm INT,
hits_publisher_adsenseBackfillDfpViewableImpressions INT,
hits_publisher_adxBackfillDfpClicks INT,
hits_publisher_adxBackfillDfpImpressions INT,
hits_publisher_adxBackfillDfpMatchedQueries INT,
hits_publisher_adxBackfillDfpMeasurableImpressions INT,
hits_publisher_adxBackfillDfpPagesViewed INT,
hits_publisher_adxBackfillDfpQueries INT,
hits_publisher_adxBackfillDfpRevenueCpc INT,
hits_publisher_adxBackfillDfpRevenueCpm INT,
hits_publisher_adxBackfillDfpViewableImpressions INT,
hits_publisher_dfpAdGroup VARCHAR,
hits_publisher_dfpAdUnits VARCHAR,
hits_publisher_dfpClicks INT,
hits_publisher_dfpImpressions INT,
hits_publisher_dfpMatchedQueries INT,
hits_publisher_dfpMeasurableImpressions INT,
hits_publisher_dfpNetworkId VARCHAR,
hits_publisher_dfpPagesViewed INT,
hits_publisher_dfpQueries INT,
hits_publisher_dfpRevenueCpc INT,
hits_publisher_dfpRevenueCpm INT,
hits_publisher_dfpViewableImpressions INT,
hits_customVariables VARIANT,
hits_customVariables_index INT,
hits_customVariables_customVarName VARCHAR,
hits_customVariables_customVarValue VARCHAR,
hits_customDimensions VARIANT,
hits_customDimensions_index INT,
hits_customDimensions_value VARCHAR,
hits_customMetrics VARIANT,
hits_customMetrics_index INT,
hits_customMetrics_value INT,
hits_social VARIANT,
hits_social_hasSocialSourceReferral VARCHAR,
hits_social_socialInteractionAction VARCHAR,
hits_social_socialInteractionNetwork VARCHAR,
hits_social_socialInteractionNetworkAction VARCHAR,
hits_social_socialInteractions INT,
hits_social_socialInteractionTarget VARCHAR,
hits_social_socialNetwork VARCHAR,
hits_social_uniqueSocialInteractions INT,
hits_contentGroup VARIANT,
hits_contentGroup_contentGroupUniqueViews2 VARCHAR,
hits_contentGroup_contentGroup1 VARCHAR,
hits_contentGroup_contentGroup2 VARCHAR,
hits_contentGroup_contentGroup3 VARCHAR,
hits_contentGroup_contentGroup4 VARCHAR,
hits_contentGroup_contentGroup5 VARCHAR,
hits_contentGroup_previousContentGroup1 VARCHAR,
hits_contentGroup_previousContentGroup2 VARCHAR,
hits_contentGroup_previousContentGroup3 VARCHAR,
hits_contentGroup_previousContentGroup4 VARCHAR,
hits_contentGroup_previousContentGroup5 VARCHAR,
hits_product_customDimensions VARIANT,
hits_product_customDimensions_index INT,
hits_product_customDimensions_value VARCHAR,
hits_product VARIANT,
hits_product_localProductPrice INT,
hits_product_localProductRefundAmount INT,
hits_product_localProductRevenue INT,
hits_product_productBrand VARCHAR,
hits_product_productPrice INT,
hits_product_productQuantity INT,
hits_product_productRefundAmount INT,
hits_product_productRevenue INT,
hits_product_productSKU VARCHAR,
hits_product_productVariant VARCHAR,
hits_product_v2ProductCategory VARCHAR,
hits_product_v2ProductName VARCHAR,
hits_product_isImpression BOOLEAN,
hits_product_isClick BOOLEAN,
hits_product_productListName VARCHAR,
hits_product_productListPosition INT
)
cluster by (fullVisitorId, date);

create table if not exists {{ params.stage_db }}.{{ params.stage_schema }}.{{ params.stage_table_compact }}
(
clientId VARCHAR ,
fullVisitorId VARCHAR NOT NULL,
visitorId VARCHAR,
userId VARCHAR,
visitNumber INT,
visitId INT NOT NULL,
visitStartTime INT,
date DATE,
totals VARIANT,
totals_bounces INT,
totals_hits INT,
totals_newVisits INT,
totals_pageviews INT,
totals_screenviews INT,
totals_sessionQualityDim INT,
totals_timeOnScreen INT,
totals_timeOnSite INT,
totals_totalTransactionRevenue INT,
totals_transactionRevenue INT,
totals_transactions INT,
totals_UniqueScreenViews INT,
totals_visits INT,
trafficSource VARIANT,
trafficSource_adContent VARCHAR,
trafficSource_adwordsClickInfo VARIANT,
trafficSource_adwordsClickInfo_adGroupId INT,
trafficSource_adwordsClickInfo_adNetworkType VARCHAR,
trafficSource_adwordsClickInfo_campaignId INT,
trafficSource_adwordsClickInfo_creativeId INT,
trafficSource_adwordsClickInfo_criteriaId INT,
trafficSource_adwordsClickInfo_criteriaParameters VARCHAR,
trafficSource_adwordsClickInfo_customerId INT,
trafficSource_adwordsClickInfo_gclId VARCHAR,
trafficSource_adwordsClickInfo_isVideoAd BOOLEAN,
trafficSource_adwordsClickInfo_page INT,
trafficSource_adwordsClickInfo_slot VARCHAR,
trafficSource_adwordsClickInfo_targetingCriteria VARIANT,
trafficSource_adwordsClickInfo_targetingCriteria_boomUserlistId INT,
trafficSource_campaign VARCHAR,
trafficSource_campaignCode VARCHAR,
trafficSource_isTrueDirect BOOLEAN,
trafficSource_keyword VARCHAR,
trafficSource_medium VARCHAR,
trafficSource_referralPath VARCHAR,
trafficSource_source VARCHAR,
socialEngagementType VARCHAR,
channelGrouping VARCHAR,
device VARIANT,
device_browser VARCHAR,
device_browserSize VARCHAR,
device_browserVersion VARCHAR,
device_deviceCategory VARCHAR,
device_mobileDeviceInfo VARCHAR,
device_mobileDeviceMarketingName VARCHAR,
device_mobileDeviceModel VARCHAR,
device_mobileInputSelector VARCHAR,
device_operatingSystem VARCHAR,
device_operatingSystemVersion VARCHAR,
device_isMobile BOOLEAN,
device_mobileDeviceBranding VARCHAR,
device_flashVersion VARCHAR,
device_javaEnabled BOOLEAN,
device_language VARCHAR,
device_screenColors VARCHAR,
device_screenResolution VARCHAR,
customDimensions VARIANT,
geoNetwork VARIANT,
geoNetwork_continent VARCHAR,
geoNetwork_subContinent VARCHAR,
geoNetwork_country VARCHAR,
geoNetwork_region VARCHAR,
geoNetwork_metro VARCHAR,
geoNetwork_city VARCHAR,
geoNetwork_cityId VARCHAR ,
geoNetwork_latitude VARCHAR,
geoNetwork_longitude VARCHAR,
geoNetwork_networkDomain VARCHAR,
geoNetwork_networkLocation VARCHAR,
hits VARIANT,
privacy_info VARIANT,
privacy_info_ads_storage VARCHAR,
privacy_info_analytics_storage VARCHAR,
privacy_info_uses_transient_token VARCHAR,
hash_id VARCHAR
)
cluster by (fullVisitorId, date);
